<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" th:href="@{/assets/css/colorbox.css}" />
<head th:include="fragments/head::header" />
<body>
<div th:include="fragments/top::top" ></div>

<div class="main-container" id="main-container">
    <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
    </script>

    <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
            <span class="menu-text"></span>
        </a>

        <div th:include="fragments/left::left" ></div>

        <div class="main-content">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
                </script>

                <ul class="breadcrumb">
                    <li>
                        <i class="icon-home home-icon"></i>
                        <a href="#">首页</a>
                    </li>

                    <li>
                        <a href="#">运营管理</a>
                    </li>
                    <li>
                        <a href="/article/list">内容管理</a>
                    </li>
                    <li class="active">内容列表</li>
                </ul><!-- .breadcrumb -->

            </div>

            <div class="page-content">
                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->

                        <div class="row">
                            <div class="col-xs-12">
                                <h3 class="header smaller lighter blue">内容管理</h3>
                                <div class="table-header">
                                    <form class="form-inline">
                                        <div class="form-group">
                                            <label for="articleName">标题：</label>
                                            <input type="text" id="articleName" class="form-control input-sm" placeholder="" style="width:100px;"/>
                                        </div>
                                        <div class="form-group">
                                            <label for="labelId">标签：</label>
                                            <select class="form-control input-sm" id="labelId" name="labelId" style="width:150px;">
                                                <option value="">--全部--</option>
                                                    <option th:each="label:${labelList}" th:value="${label.id}" th:text="${label.labelContent}"></option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="startTime">发布时间：</label>
                                            <input type="text" id="startTime" name="startTime"	class="datepicker" style="width:100px;"/>至<input type="text" id="endTime" name="endTime" class="datepicker" style="width:100px;"/>
                                        </div>
                                        <button type="button"  id="query" class="btn btn-success">查询</button>
                                        <button type="reset" class="btn btn-warning">清空</button>

                                        <a href="/article/add" id="addArticle" class="btn btn-success pull-right">添加内容</a>
                                    </form>
                                </div>

                                <div class="table-responsive">
                                    <div id="alert" class="alert alert-success" style="display: none;" role="alert">
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        <span id="alertText"></span>
                                    </div>
                                    <table id="sample-table-2" class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th class="center">
                                                <label>
                                                    <input type="checkbox" class="ace" />
                                                    <span class="lbl"></span>
                                                </label>
                                            </th>
                                            <th class="hide">id</th>
                                            <th>标题</th>
                                            <th>标签</th>
                                            <th class="hidden-480">发布时间</th>
                                            <th>点赞数</th>
                                            <th>
                                                首图
                                            </th>
                                            <th>
                                                置顶值
                                            </th>
                                            <th class="hidden-480">操作</th>

                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.page-content -->
        </div>

        <div th:include="fragments/bottom::bottom"></div>
    </div>

    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="icon-double-angle-up icon-only bigger-110"></i>
    </a>
</div><!-- /.main-container -->

<!-- Modal备注 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

        </div>
    </div>
</div>
<div th:include="fragments/js::js"></div>


<!-- page specific plugin scripts -->
<script th:src="@{/assets/js/jquery.dataTables.min.js}"></script>
<script th:src="@{/assets/js/jquery.dataTables.bootstrap.js}"></script>
<script th:src="@{/assets/js/date-time/bootstrap-datepicker.min.js}" charset="UTF-8"></script>
<script th:src="@{/assets/js/temp.js}" charset="UTF-8"></script>
<!--图片查看器-->
<script th:src="@{/assets/js/jquery.colorbox-min.js}"></script>
<!--<script th:src="@{/assets/js/jquery-ui-1.10.3.full.min.js}"></script>-->
<!--<script th:src="@{/assets/js/jquery.ui.touch-punch.min.js}"></script>-->
<script type="text/javascript">
    <!--
    var oTable1;
    jQuery(function($) {

        var colorbox_params = {
            reposition:true,
            scalePhotos:true,
            scrolling:false,
            previous:'<i class="icon-arrow-left"></i>',
            next:'<i class="icon-arrow-right"></i>',
            close:'&times;',
            current:'{current} of {total}',
            maxWidth:'100%',
            maxHeight:'100%',
            onOpen:function(){
                document.body.style.overflow = 'hidden';
            },
            onClosed:function(){
                document.body.style.overflow = 'auto';
            },
            onComplete:function(){
                $.colorbox.resize();
            }
        }

        oTable1 = $('#sample-table-2').on( 'draw.dt', function () {
            $('.colorbox').colorbox(colorbox_params);
        } ).dataTable( {
//            "bPaginate" : true,//使用分页
            "bFilter": false,//是否使用搜索
            "bProcessing": true,
            "bDeferRender" : true,//
            "sPaginationType": "bs_normal",//分页样式
            "bRetrieve" : true,//是否调用后台
            "bServerSide": true,//是否以后台分页
            "sAjaxSource" : "/article/list",//请求路径
            "fnServerData" : function(sSource, aoData, fnCallback) {
                aoData.push(
                    {"name":"articleName","value":$("#articleName").val()},
                    {"name":"labelId","value":$("#labelId").select().val()},
                    {"name":"startTime","value":$("#startTime").val()},
                    {"name":"endTime","value":$("#endTime").val()}
                )
                $.ajax({
                    "dataType" : 'json',
                    "type" : "POST",
                    "url" : sSource,
                    "data" : aoData,
                    "success" : fnCallback
                });
            },
            "aaSorting": [[ 4, "desc" ]],
            "aoColumns": [
                { "sClass": "center","bSortable": false,"mData": function(source) {
                    return '<td class="center"><label><input type="checkbox" class="ace" name="row_sel" value="'+source.id+'" /><span class="lbl"></span> </label></td>';
                }},
                { "sClass": "center","bVisible":false, "mData":"id"},//此列不显示
                { "sClass": "center","bSortable": false,"mData":"articleName" },
                { "sClass": "center","bSortable": false,"mData":"articleLabel"},
                { "sClass": "center","bSortable": true,"mData":"created"},//会员ID
                { "sClass": "center","bSortable": true,"mData":"number"},
                { "sClass": "center","bSortable": false,"mData":function (source) {
                    return '<a href="'+source.picture+'" title="Photo Title" class="colorbox" data-rel="colorbox"> <img alt="150x150" src="'+source.picture+'" height="20" width="40" /></a>'
//                    return '<img src="'+source.picture+'"  height="30" width="40" >';
                }},
                { "sClass": "center","bSortable": false,"mData":function(source){
                    return source.topStatus? source.topStatus:0;
                }},
                { "sClass": "center","bSortable": false,"mData": function (source) {
                    var detail = '<a href="/article/detail?id='+source.id+'" target="_blank">详情</a>&nbsp;&nbsp;&nbsp;';
                    var edit = '<a href="/article/update?id='+source.id+'" target="_blank">编辑</a>&nbsp;&nbsp;&nbsp;';
                    var topStatus = '<a href="/article/top?id='+source.id+'"  data-toggle="modal" data-target="#myModal">置顶</a>&nbsp;&nbsp;&nbsp;';
                    var deleteStatus = '<a href="javascript:void(0);" onclick="hideStatus('+!source.deleteStatus+','+source.id+')" >删除</a>';
                    return detail+edit+topStatus+deleteStatus;

                }
                }
            ],
            "oLanguage": {
                "sLengthMenu": "每页 _MENU_条 ",
                "sZeroRecords": "对不起，查询不到任何相关数据",
                "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录 ",
                "sInfoEmpty": "显示 0 到 0 条，共 0 条记录",
                "sInfoFiltered": "数据表中共为 _MAX_ 条记录)",
                "sProcessing": "正在加载中...",
                "sSearch": "搜索",
                "sUrl": "", //多语言配置文件，可将oLanguage的设置放在一个txt文件中，例：Javascript/datatable/dtCH.txt
                "oPaginate": {
                    "sFirst":    "第一页",
                    "sPrevious": " 上一页 ",
                    "sNext":     " 下一页 ",
                    "sLast":     " 最后一页 "
                }
            } //多语言配置

        } );

        $(".datepicker").datepicker({
            language: "cn",
            autoclose: true,//选中之后自动隐藏日期选择框
            clearBtn: true,//清除按钮
            todayBtn: 1,//今日按钮
            format: "yyyy-mm-dd"//日期格式，详见 http://bootstrap-datepicker.readthedocs.org/en/release/options.html#format
        });

        $('table th input:checkbox').on('click' , function(){
            var that = this;
            $(this).closest('table').find('tr > td:first-child input:checkbox')
                .each(function(){
                    this.checked = that.checked;
                    $(this).closest('tr').toggleClass('selected');
                });

        });


        $('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
        function tooltip_placement(context, source) {
            var $source = $(source);
            var $parent = $source.closest('table')
            var off1 = $parent.offset();
            var w1 = $parent.width();

            var off2 = $source.offset();
            var w2 = $source.width();

            if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
            return 'left';
        }


        $("#query").click(function () {
            oTable1.fnDraw();
            $('.colorbox').colorbox(colorbox_params);
        })




    })

    function hideStatus(deleteStatus,id){
        $.ajax({
            url:'/article/mask',
            type:'POST',
            data:{deleteStatus:deleteStatus,id:id},
            success:function(data){
                if(data){
                    alert("操作成功!")
                    oTable1.fnDraw();
                }else {
                    alert("操作失败!")
                }
            }
        })
    }
    -->





</script>
</body>
</html>
